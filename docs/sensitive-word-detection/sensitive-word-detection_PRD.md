# 敏感词检测服务 - 产品需求文档 (PRD)

## 1. 项目背景
随着互联网内容的爆炸式增长，内容安全和合规性变得越来越重要。敏感词检测服务是内容审核系统的核心组件之一，需要高效、准确地识别和过滤用户生成的内容中的敏感信息。

## 2. 项目目标
- **主要目标**：构建一个高性能、可扩展的敏感词检测RESTful API服务
- **技术目标**：实现毫秒级响应时间，支持并发请求处理
- **业务目标**：提供准确的敏感词检测，支持多种检测策略和自定义敏感词库

## 3. 核心功能列表
### 3.1 基础检测功能
- [ ] 文本敏感词检测
- [ ] 支持精确匹配和模糊匹配
- [ ] 返回检测结果和命中的敏感词位置

### 3.2 敏感词库管理
- [ ] 预置常见敏感词库
- [ ] 支持自定义敏感词库上传/更新
- [ ] 支持敏感词分类（政治、色情、暴力、广告等）

### 3.3 检测策略
- [ ] 基于规则的检测（关键词匹配）
- [ ] 基于ML模型的语义检测（可选）
- [ ] 支持检测严格程度配置

#### 3.3.1 规则匹配检测策略
**核心原理**：基于预定义的敏感词库进行精确或模糊匹配

**技术实现**：
- **精确匹配**：使用Trie树（前缀树）或AC自动机算法实现高效字符串匹配
- **模糊匹配**：处理变体词、同音词、形近词等绕过手段
- **正则表达式**：支持复杂模式匹配（如手机号、身份证号等格式检测）

**匹配策略**：
1. **完全匹配**：敏感词与文本完全一致
2. **包含匹配**：文本中包含敏感词子串
3. **边界匹配**：考虑词语边界，避免误匹配（如"法轮功"不匹配"方法轮廓功能"）
4. **忽略特殊字符**：过滤空格、标点、特殊符号后再匹配
5. **繁简转换**：统一转换为简体中文后匹配
6. **拼音匹配**：检测拼音缩写或谐音替换

**绕过检测处理**：
- 字符插入：f*u*c*k → fuck
- 字符替换：用数字/符号替换字母 (如 5h1t → shit)
- 繁简混用：敏感詞 → 敏感词
- 拆分重组：敏 感 词 → 敏感词

**优势**：
- 响应速度快（< 10ms）
- 准确率高，误报少
- 易于维护和更新词库
- 资源消耗小

**局限性**：
- 难以处理上下文语义
- 容易被新型绕过手段突破
- 需要持续更新词库

#### 3.3.2 ML语义检测策略（可选高级功能）
**核心原理**：使用预训练语言模型理解文本语义，识别隐含的敏感内容

**技术实现**：
- **预训练模型**：基于BERT/RoBERTa等Transformer模型
- **分类任务**：多标签文本分类（政治敏感/色情暴力/仇恨言论等）
- **语义相似度**：计算文本与敏感语义模板的相似度
- **上下文理解**：分析整句/段落的语义倾向

**模型架构**：
```
输入文本 → 文本预处理 → BERT编码 → 分类头 → 敏感度评分
```

**检测能力**：
1. **隐晦表达检测**：如"某个组织"指代敏感组织
2. **语义相似性**：识别与已知敏感内容语义相近的表达
3. **情感倾向分析**：检测仇恨、暴力倾向的语言
4. **讽刺挖苦识别**：理解反讽等复杂语言现象

**应用场景**：
- 检测规则匹配遗漏的敏感内容
- 识别新兴网络用语和暗语
- 处理语义层面的违规内容
- 上下文相关的敏感判断

**优势**：
- 语义理解能力强
- 能够检测新型表达方式
- 适应性强，可持续学习

**局限性**：
- 计算资源消耗大
- 响应时间较长（50-200ms）
- 可能存在误报
- 需要大量标注数据训练

#### 3.3.3 混合检测策略
**策略组合**：
1. **优先级检测**：先执行快速的规则匹配，命中则直接返回
2. **兜底检测**：规则未命中时，使用ML模型进行语义检测
3. **置信度融合**：结合两种方法的检测结果和置信度
4. **分级处理**：根据内容类型和业务场景选择检测策略

**配置化检测严格程度**：
- **宽松模式**：仅规则匹配，误报率低，漏报率相对较高
- **标准模式**：规则匹配 + 高置信度ML检测
- **严格模式**：规则匹配 + 全量ML检测，误报率较高但覆盖全面
- **自定义模式**：业务方可自定义检测阈值和策略组合

## 4. 项目范围
### 4.1 包含功能
- 文本内容敏感词检测API
- 敏感词库管理API
- 检测结果详情输出
- 基础的性能监控

### 4.2 不包含功能
- 图片/视频内容检测
- 实时流式数据处理
- 用户权限管理系统
- 复杂的审核工作流

## 5. 技术要求
### 5.1 性能要求
#### 5.1.1 规则匹配性能指标
- API响应时间：< 50ms (P95)
- 并发处理能力：> 2000 QPS
- 准确率：> 98% (基于已知敏感词库)
- 内存使用：< 500MB (包含完整词库)

#### 5.1.2 ML语义检测性能指标
- API响应时间：< 200ms (P95)
- 并发处理能力：> 500 QPS
- 准确率：> 92% (语义检测任务)
- GPU内存使用：< 2GB (模型推理)

#### 5.1.3 混合策略性能指标
- 综合响应时间：< 100ms (P95)
- 并发处理能力：> 1000 QPS
- 综合准确率：> 95%
- 召回率：> 90%

### 5.2 算法要求
#### 5.2.1 规则匹配算法
- **核心算法**：AC自动机（Aho-Corasick）+ Trie树
- **字符串处理**：支持UTF-8编码，处理中英文混合文本
- **预处理能力**：繁简转换、大小写标准化、特殊字符过滤
- **词库规模**：支持10万+敏感词条高效检索

#### 5.2.2 ML模型要求
- **模型类型**：BERT-base或同等级预训练模型
- **模型大小**：< 500MB
- **支持分类**：政治敏感、色情暴力、仇恨言论、垃圾广告、个人隐私
- **多语言支持**：优先支持中文，可扩展英文

### 5.2 可用性要求
- 服务可用率：> 99.9%
- 支持水平扩展
- 优雅的错误处理和降级策略

## 6. 接口规范概览
### 6.1 核心检测接口
- `POST /api/v1/detect` - 文本敏感词检测
- `GET /api/v1/health` - 健康检查

### 6.2 管理接口 (可选扩展)
- `GET /api/v1/wordlists` - 获取敏感词库列表
- `POST /api/v1/wordlists` - 上传自定义敏感词库
- `PUT /api/v1/wordlists/{id}` - 更新敏感词库

## 7. 数据模型详细设计
### 7.1 检测请求模型
```json
{
  "text": "待检测的文本内容",
  "config": {
    "detection_mode": "rule|semantic|hybrid",
    "strictness_level": "loose|standard|strict|custom",
    "categories": ["political", "pornographic", "violent", "spam", "privacy"],
    "return_positions": true,
    "return_suggestions": false,
    "custom_threshold": 0.8
  }
}
```

**字段说明**：
- `text`: 必填，待检测的文本内容（最大长度10000字符）
- `detection_mode`: 检测模式
  - `rule`: 仅规则匹配
  - `semantic`: 仅ML语义检测  
  - `hybrid`: 混合检测（默认）
- `strictness_level`: 检测严格程度
- `categories`: 检测的敏感词分类，空数组表示检测所有类别
- `return_positions`: 是否返回敏感词在文本中的位置
- `return_suggestions`: 是否返回替换建议
- `custom_threshold`: 自定义检测阈值（0.0-1.0）

### 7.2 检测响应模型
```json
{
  "is_sensitive": true,
  "risk_level": "high",
  "overall_score": 0.85,
  "detection_time_ms": 45,
  "detection_mode_used": "hybrid",
  "results": [
    {
      "matched_word": "敏感词",
      "category": "political",
      "match_type": "exact",
      "confidence": 0.95,
      "positions": [
        {
          "start": 10,
          "end": 13
        }
      ],
      "detection_method": "rule",
      "suggestion": "***"
    }
  ],
  "summary": {
    "total_matches": 1,
    "categories_found": ["political"],
    "highest_risk_category": "political"
  }
}
```

**字段说明**：
- `is_sensitive`: 是否包含敏感内容
- `risk_level`: 风险等级 (low|medium|high|critical)
- `overall_score`: 整体敏感度评分 (0.0-1.0)
- `detection_time_ms`: 检测耗时（毫秒）
- `results`: 检测到的敏感词详情列表
  - `matched_word`: 匹配到的敏感词
  - `category`: 敏感词分类
  - `match_type`: 匹配类型 (exact|fuzzy|semantic)
  - `confidence`: 检测置信度
  - `positions`: 在原文中的位置
  - `detection_method`: 检测方法 (rule|semantic)
  - `suggestion`: 替换建议
- `summary`: 检测结果汇总

## 8. 里程碑计划
- **里程碑1**：基础文本检测功能 (MVP)
- **里程碑2**：敏感词库管理功能
- **里程碑3**：性能优化和高级检测策略
